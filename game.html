<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LastStand - Roguelike Survival Game</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/game-layout.css">
    <link rel="stylesheet" href="css/equipment.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/levelup.css">
    <link rel="stylesheet" href="css/save-system.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <!-- 开始界面 -->
    <div id="startScreen" class="screen">
        <h1>LastStand</h1>
        <div class="menu-buttons">
            <button id="newGameBtn" class="menu-btn">🎮 新游戏</button>
            <button id="loadGameBtn" class="menu-btn" disabled>📂 读取存档</button>
        </div>
        <!-- 人数选择 -->
        <div id="playerCountSelection" class="player-count-selection hidden">
            <h2>选择游戏人数</h2>
            <div class="player-count-buttons">
                <button class="player-count-btn" data-count="1">
                    <span class="count-icon">👤</span>
                    <span class="count-text">单人模式</span>
                    <span class="count-hint">WASD 或 方向键</span>
                </button>
                <button class="player-count-btn" data-count="2">
                    <span class="count-icon">👥</span>
                    <span class="count-text">双人模式</span>
                    <span class="count-hint">P1: WASD | P2: 方向键</span>
                </button>
            </div>
        </div>
        <!-- 难度选择 -->
        <div id="difficultySelection" class="difficulty-selection hidden">
            <h2>选择难度</h2>
            <div class="difficulty-cards">
                <div class="difficulty-card" data-difficulty="easy">
                    <div class="difficulty-icon easy"></div>
                    <h3>简单</h3>
                    <p>敌人较弱，适合新手</p>
                    <ul class="difficulty-modifiers">
                        <li>敌人生命 -30%</li>
                        <li>敌人伤害 -30%</li>
                        <li>经验获取 +20%</li>
                    </ul>
                </div>
                <div class="difficulty-card selected" data-difficulty="normal">
                    <div class="difficulty-icon normal"></div>
                    <h3>普通</h3>
                    <p>标准难度体验</p>
                    <ul class="difficulty-modifiers">
                        <li>敌人生命 100%</li>
                        <li>敌人伤害 100%</li>
                        <li>经验获取 100%</li>
                    </ul>
                </div>
                <div class="difficulty-card" data-difficulty="hard">
                    <div class="difficulty-icon hard"></div>
                    <h3>困难</h3>
                    <p>更强的敌人挑战</p>
                    <ul class="difficulty-modifiers">
                        <li>敌人生命 +50%</li>
                        <li>敌人伤害 +50%</li>
                        <li>经验获取 +30%</li>
                    </ul>
                </div>
                <div class="difficulty-card" data-difficulty="nightmare">
                    <div class="difficulty-icon nightmare"></div>
                    <h3>噩梦</h3>
                    <p>极限生存挑战</p>
                    <ul class="difficulty-modifiers">
                        <li>敌人生命 +100%</li>
                        <li>敌人伤害 +100%</li>
                        <li>经验获取 +50%</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- 地图选择 -->
        <div id="mapSelection" class="map-selection hidden">
            <h2>选择地图</h2>
            <div class="map-cards">
                <div class="map-card selected" data-map="forest">
                    <div class="map-preview forest"></div>
                    <h3>🌲 幽暗森林</h3>
                    <p>茂密的树林，隐藏着危险</p>
                </div>
                <div class="map-card" data-map="desert">
                    <div class="map-preview desert"></div>
                    <h3>🏜️ 荒芜沙漠</h3>
                    <p>炎热的沙漠，视野开阔</p>
                </div>
                <div class="map-card" data-map="dungeon">
                    <div class="map-preview dungeon"></div>
                    <h3>🏰 黑暗地牢</h3>
                    <p>阴暗的地下城，怪物横行</p>
                </div>
                <div class="map-card" data-map="snow">
                    <div class="map-preview snow"></div>
                    <h3>❄️ 冰封雪原</h3>
                    <p>寒冷的雪地，移动减速</p>
                </div>
                <div class="map-card" data-map="lava">
                    <div class="map-preview lava"></div>
                    <h3>🌋 熔岩地狱</h3>
                    <p>危险的火山，持续伤害</p>
                </div>
                <div class="map-card" data-map="ocean">
                    <div class="map-preview ocean"></div>
                    <h3>🌊 深海遗迹</h3>
                    <p>神秘的海底，宝藏丰富</p>
                </div>
            </div>
            <button id="startGameBtn" class="menu-btn start-btn">开始游戏</button>
        </div>
        <!-- 职业选择 -->
        <div id="classSelection" class="class-selection hidden">
            <h2 id="classSelectionTitle">选择你的职业</h2>
            <div class="class-cards">
                <div class="class-card" data-class="warrior">
                    <h3>🛡️ 战士</h3>
                    <p class="class-desc">近战之王，高生命高防御</p>
                    <p class="class-stats">❤️150 ⚔️15 💨3</p>
                    <p class="class-passive">被动：减伤10%，攻击击退敌人</p>
                </div>
                <div class="class-card" data-class="mage">
                    <h3>🧙 法师</h3>
                    <p class="class-desc">远程魔法输出，高伤害低生命</p>
                    <p class="class-stats">❤️80 ⚔️25 💨3.5</p>
                    <p class="class-passive">被动：魔法穿透，攻击范围+30%</p>
                </div>
                <div class="class-card" data-class="assassin">
                    <h3>🥷 刺客</h3>
                    <p class="class-desc">极速暗杀，高暴击高闪避</p>
                    <p class="class-stats">❤️100 ⚔️20 💨5</p>
                    <p class="class-passive">被动：25%暴击率，首击必暴</p>
                </div>
                <div class="class-card" data-class="ranger">
                    <h3>🏹 游侠</h3>
                    <p class="class-desc">远程射手，多重箭矢</p>
                    <p class="class-stats">❤️110 ⚔️18 💨4</p>
                    <p class="class-passive">被动：发射2支箭，攻速+20%</p>
                </div>
                <div class="class-card" data-class="summoner">
                    <h3>🔮 召唤师</h3>
                    <p class="class-desc">召唤幽灵作战，团队作战</p>
                    <p class="class-stats">❤️90 ⚔️12 💨3.2</p>
                    <p class="class-passive">被动：召唤3幽灵，击杀回血</p>
                </div>
                <div class="class-card" data-class="knight">
                    <h3>⚔️ 骑士</h3>
                    <p class="class-desc">重甲坦克，反伤护盾</p>
                    <p class="class-stats">❤️180 ⚔️18 💨2.8</p>
                    <p class="class-passive">被动：减伤15%，反弹20%伤害</p>
                </div>
                <div class="class-card" data-class="paladin">
                    <h3>✝️ 圣骑士</h3>
                    <p class="class-desc">圣光战士，治愈与惩戒</p>
                    <p class="class-stats">❤️140 ⚔️16 💨3</p>
                    <p class="class-passive">被动：攻击回血，亡灵伤害+50%</p>
                </div>
                <div class="class-card" data-class="necromancer">
                    <h3>💀 死灵法师</h3>
                    <p class="class-desc">黑暗召唤，生命汲取</p>
                    <p class="class-stats">❤️75 ⚔️22 💨3.3</p>
                    <p class="class-passive">被动：召唤5骷髅，吸取5%生命</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 存档覆盖确认弹窗 -->
    <div id="overwriteModal" class="modal hidden">
        <div class="modal-content">
            <h3>⚠️ 存档确认</h3>
            <p>该存档位已有数据，是否覆盖？</p>
            <div class="modal-buttons">
                <button id="overwriteYes" class="modal-btn confirm">确认覆盖</button>
                <button id="overwriteNo" class="modal-btn cancel">取消</button>
            </div>
        </div>
    </div>

    <!-- 存档选择界面 -->
    <div id="saveSlotScreen" class="screen hidden">
        <div class="save-slot-content">
            <h2 id="saveSlotTitle">📂 选择存档位</h2>
            <div class="save-slots" id="saveSlots">
                <!-- 存档位会通过JS动态生成 -->
            </div>
            <button id="saveSlotBackBtn" class="menu-btn">返回</button>
        </div>
    </div>

    <!-- 游戏界面 -->
    <div id="gameScreen" class="screen hidden">
        <!-- 顶部控制栏 -->
        <div class="top-bar">
            <div class="info-item"><span class="label">🪙</span><span id="goldCount">0</span></div>
            <div class="info-item"><span class="label">🌊</span><span id="waveCount">1</span></div>
            <div class="info-item"><span class="label">💀</span><span id="killCount">0</span></div>
            <div class="info-item"><span class="label">⏱️</span><span id="gameTime">0</span>s</div>
            <button class="top-btn save" id="saveBtn">💾 保存</button>
            <button class="top-btn pause" id="pauseBtn">⏸️ 暂停</button>
        </div>

        <!-- 游戏主区域（P1面板+画布+P2面板） -->
        <div class="game-main-area">
            <!-- P1属性面板（左侧） -->
            <div class="player-side-panel" id="p1Panel">
                <div class="player-panel">
                    <div class="player-header">
                        <span class="player-tag p1">P1</span>
                        <span class="player-class" id="p1ClassName">战士</span>
                    </div>
                    <div class="player-stats">
                        <div class="stat-tag health">❤️ <span id="playerHealth">100</span>/<span id="playerMaxHealth">100</span></div>
                        <div class="stat-tag level">⭐ Lv.<span id="playerLevel">1</span></div>
                        <div class="stat-tag">📊 <span id="playerExp">0</span>/<span id="playerMaxExp">100</span></div>
                        <div class="stat-tag">⚔️ <span id="playerAttack">10</span></div>
                        <div class="stat-tag">🏃 <span id="playerSpeed">3</span></div>
                        <div class="stat-tag">💖 <span id="playerRegen">0</span>/s</div>
                        <div class="stat-tag">💥 <span id="playerCrit">0</span>%</div>
                        <div class="stat-tag">🩸 <span id="playerVampire">0</span></div>
                        <div class="stat-tag">💢 <span id="playerCritDmg">200%</span></div>
                        <div class="stat-tag">📍 <span id="playerRange">50</span></div>
                        <div class="stat-tag">⚡ <span id="playerAtkSpeed">500ms</span></div>
                        <div class="stat-tag">🎯 <span id="playerMultishot">1</span></div>
                        <div class="stat-tag">✨ <span id="playerExpBonus">100%</span></div>
                    </div>
                    <div class="player-equipment">
                        <div class="equipment-label">🗡️ 武器</div>
                        <div class="weapon-bar" id="weaponBar"></div>
                        <div class="equipment-label">💎 被动</div>
                        <div class="passive-bar" id="passiveBar"></div>
                    </div>
                </div>
            </div>

            <!-- 游戏画布 -->
            <canvas id="gameCanvas"></canvas>

            <!-- P2属性面板（右侧，双人模式显示） -->
            <div class="player-side-panel right-panel hidden" id="p2Panel">
                <div class="player-panel">
                    <div class="player-header">
                        <span class="player-tag p2">P2</span>
                        <span class="player-class" id="p2ClassName">战士</span>
                    </div>
                    <div class="player-stats">
                        <div class="stat-tag health">❤️ <span id="player2Health">100</span>/<span id="player2MaxHealth">100</span></div>
                        <div class="stat-tag level">⭐ Lv.<span id="player2Level">1</span></div>
                        <div class="stat-tag">📊 <span id="player2Exp">0</span>/<span id="player2MaxExp">100</span></div>
                        <div class="stat-tag">⚔️ <span id="player2Attack">10</span></div>
                        <div class="stat-tag">🏃 <span id="player2Speed">3</span></div>
                        <div class="stat-tag">💖 <span id="player2Regen">0</span>/s</div>
                        <div class="stat-tag">💥 <span id="player2Crit">0</span>%</div>
                        <div class="stat-tag">🩸 <span id="player2Vampire">0</span></div>
                        <div class="stat-tag">💢 <span id="player2CritDmg">200%</span></div>
                        <div class="stat-tag">📍 <span id="player2Range">50</span></div>
                        <div class="stat-tag">⚡ <span id="player2AtkSpeed">500ms</span></div>
                        <div class="stat-tag">🎯 <span id="player2Multishot">1</span></div>
                        <div class="stat-tag">✨ <span id="player2ExpBonus">100%</span></div>
                    </div>
                    <div class="player-equipment">
                        <div class="equipment-label">🗡️ 武器</div>
                        <div class="weapon-bar" id="weaponBar2"></div>
                        <div class="equipment-label">💎 被动</div>
                        <div class="passive-bar" id="passiveBar2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 暂停界面 -->
    <div id="pauseScreen" class="screen hidden">
        <div class="pause-content">
            <h2>⏸️ 游戏暂停</h2>
            <div class="pause-buttons">
                <button id="resumeBtn" class="pause-btn">▶️ 继续游戏</button>
                <button id="pauseSaveBtn" class="pause-btn">💾 保存并退出</button>
                <button id="pauseRestartWaveBtn" class="pause-btn">🔄 重新开始本波</button>
                <button id="pauseReturnMenuBtn" class="pause-btn danger">🏠 返回主菜单</button>
            </div>
        </div>
    </div>

    <!-- 倒计时界面 -->
    <div id="countdownScreen" class="screen hidden">
        <div class="countdown-number" id="countdownNumber">3</div>
        <p class="countdown-text">游戏即将开始...</p>
    </div>

    <!-- 武器详情弹窗 -->
    <div id="weaponDetailModal" class="modal hidden">
        <div class="modal-content weapon-detail">
            <span class="modal-close">&times;</span>
            <div class="weapon-detail-header">
                <span id="weaponDetailIcon" class="detail-icon">🗡️</span>
                <div>
                    <h3 id="weaponDetailName">武器名称</h3>
                    <span id="weaponDetailLevel" class="detail-level">Lv.1</span>
                </div>
            </div>
            <div class="weapon-detail-body">
                <p id="weaponDetailDesc">武器描述</p>
                <div class="weapon-stats">
                    <p>⚔️ 伤害: <span id="weaponDetailDamage">0</span></p>
                    <p>📊 类型: <span id="weaponDetailType">近战</span></p>
                </div>
                <div id="weaponEvolveInfo" class="evolve-info">
                    <h4>🔄 进化信息</h4>
                    <p>满级后与 <span id="evolvePartner">配件</span> 合成进化为:</p>
                    <p class="evolved-weapon"><span id="evolveResult">进化武器</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 升级选择界面 -->
    <div id="levelUpScreen" class="screen hidden">
        <!-- 单人模式布局 -->
        <div id="singlePlayerLevelUp" class="single-levelup">
            <h2>🎉 升级!</h2>
            <p>选择一个强化效果:</p>
            <div id="buffOptions" class="buff-options"></div>
        </div>
        <!-- 双人模式布局 -->
        <div id="dualPlayerLevelUp" class="dual-levelup hidden">
            <!-- P1选择区 -->
            <div class="player-levelup-panel p1-panel">
                <div class="player-levelup-header">
                    <span class="player-tag p1">P1</span>
                    <h3>选择强化</h3>
                </div>
                <div id="p1BuffOptions" class="buff-options"></div>
                <div id="p1Selected" class="player-selected hidden">
                    <span class="check-icon">✓</span>
                    <p>等待 P2 选择...</p>
                </div>
            </div>
            <!-- P2选择区 -->
            <div class="player-levelup-panel p2-panel">
                <div class="player-levelup-header">
                    <span class="player-tag p2">P2</span>
                    <h3>选择强化</h3>
                </div>
                <div id="p2BuffOptions" class="buff-options"></div>
                <div id="p2Selected" class="player-selected hidden">
                    <span class="check-icon">✓</span>
                    <p>等待 P1 选择...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 游戏结束界面 -->
    <div id="gameOverScreen" class="screen hidden">
        <h1>游戏结束</h1>
        <div id="gameStats">
            <p>存活时间: <span id="finalTime">0</span>秒</p>
            <p>击杀数: <span id="finalKills">0</span></p>
            <p>最终等级: <span id="finalLevel">1</span></p>
            <p>最高波次: <span id="finalWave">1</span></p>
            <p>获得金币: <span id="finalGold">0</span></p>
        </div>
        <button id="restartBtn">重新开始</button>
        <button id="returnMenuBtn">返回主菜单</button>
    </div>

    <!-- 按依赖顺序加载模块 -->
    <script src="js/config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/assets.js"></script>
    <script src="js/entities.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/save.js"></script>
    <script src="js/wave.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
